PaySavvy QR Detection Debugging Framework (Structured Guide)
âœ… Step 1: Identify the QR Source Type
ğŸ¯ Goal: Determine whether the content is a:

âœ… Scam/phishing URL

âœ… DuitNow EMV Payment Payload

âŒ Non-standard/invalid QR content

ğŸ” Run This Diagnostic in Console:
js
Copy
Edit
console.log("ğŸ“¦ Detected QR Content:", qrContent);
Then evaluate:

Test Condition	Meaning
qrContent.startsWith("http")	Itâ€™s a website URL â€” proceed with full scam detection
qrContent.startsWith("000201") or contains "A000000677010111"	Likely a DuitNow QR
Otherwise	Unknown format â€” show guidance message

âœ… Step 2: Verify QR Detection Success
ğŸ¯ Goal: Confirm whether jsQR(...) detected valid QR content in any of the 10 preprocessing passes.

ğŸ“‹ Check Log Output:
Search for this in console:

plaintext
Copy
Edit
ğŸ§ª Attempt: Inverted â†’ âœ… Detected
ğŸ§ª Attempt: Scaled 0.5 â†’ âŒ Not Detected
You should see:

Status	Meaning
âœ… At least 1 â€œDetectedâ€ log	QR decoding succeeded â†’ move to Step 3
âŒ All attempts failed	QR is not machine-readable â†’ try with clearer image

âœ… Step 3: Visual Diagnosis of File
ğŸ¯ Goal: Check if image quality or structure is causing QR detection to fail.

ğŸ” Checklist:
âœ… Question	Action
Is the image blurry or low contrast?	Use binarization or contrast boost
Is QR partially cropped or at an angle?	Use top/center smart cropping
Is the image > 1800px?	Use scaled-down detection (e.g., 0.5x, 0.3x)
Is there glare, shadows, or reflections?	Recommend retaking photo under soft light
Is QR too small in the image?	Recommend closer zoom or cropping

ğŸ“¦ Use this debug log:

js
Copy
Edit
console.log("ğŸ–¼ï¸ Image Resolution:", img.width + "x" + img.height);
console.log("ğŸ¯ Final Attempt Summary:", attemptResults);
âœ… Step 4: EMV Parsing & Merchant Validation (For DuitNow QR)
ğŸ¯ Goal: Decode EMV TLV structure and extract bank/e-wallet info.

ğŸ” Check These TLV Fields:
Tag	Field	Example
59	Merchant Name	Maybank, TNG, etc.
60	Merchant City	Johor, KL
26, 27, 28	Merchant IDs / Proxy	E-wallet ID or FPX reference

ğŸ“¦ Run:

js
Copy
Edit
const emvFields = parseEMVQR(qrContent);
console.log("ğŸ§¾ EMV Parsed Fields:", emvFields);
Then validate:

js
Copy
Edit
const merchant = emvFields["59"];
const match = verifiedBrands.find(b => merchant.includes(b.name));
console.log("ğŸ¦ Merchant Verified:", match ? "âœ… YES" : "âŒ No match");
âœ… If match is found â†’ assign Safe
âš ï¸ If no match â†’ assign Suspicious
ğŸš¨ If match known as mimic â†’ assign Dangerous

âœ… Step 5: Scam Risk Detection (URL-based QRs)
ğŸ¯ Goal: Run full 4-layer scam detection pipeline.

âœ… Check Execution Chain:
js
Copy
Edit
console.log("ğŸ”— URL Analysis Start:", qrContent);
Confirm that each layer executes:

Layer	What to Expect
Layer 1: Heuristics	Check if TLD is .tk, suspicious keywords
Layer 2: Brand Match	Domain whitelist/blacklist
Layer 3: Redirect Chain	Check for bit.ly, tinyurl and end destination
Layer 4: AI Analysis	GPT response + flags like â€œspoofed bankâ€

ğŸ“¦ Sample log:

plaintext
Copy
Edit
ğŸ§  AI Risk: Suspicious | Reason: URL mimics CIMB domain but is unverified
âœ… Step 6: Output Display Test
ğŸ¯ Goal: Ensure front-end renders correct result after detection.

ğŸ“‹ UI Should Show:
QR Type	Result
URL	Color-coded badge, Brand logo, Layer breakdown
DuitNow QR	Merchant name, Location, Trust level
Unknown	Manual input prompt and education note

âœ… Step 7: Final Risk Decision Flow
ğŸ“¦ Run this in your result render function:

js
Copy
Edit
if (qrType === "URL") {
  showScamAnalysis(qrContent, layers);
} else if (qrType === "EMV") {
  showMerchantResult(merchantName, matchStatus);
} else {
  showManualFallback("âš ï¸ QR format unrecognized. Try pasting content.");
}
ğŸ§ª Sample Diagnosis Report (After One Test)
plaintext
Copy
Edit
QR Detection Summary:
â€¢ File: img_qr.png
â€¢ Resolution: 1290x1825
â€¢ Detected QR Type: EMV Payment
â€¢ Detected Merchant: Maybank
â€¢ Verified: âœ… Yes
â€¢ Risk Level: Low (Safe)

Preprocessing Logs:
â€¢ Scaled (0.5x) â†’ Detected
â€¢ Inverted â†’ Not Detected
â€¢ Cropped Top â†’ Detected
â€¢ Final Content: EMV TLV, 18 fields
â€¢ Parsed Merchant: Maybank
â€¢ Match in verifiedBrands.json: âœ…

Output:
âœ“ EMV parsed
âœ“ Merchant validated
âœ“ Risk Score: âœ… Safe
âœ“ UX Render: âœ… Done
ğŸ›  Final Replit Developer Debugging Tip
ğŸ”§ To quick test with real QR content:

js
Copy
Edit
const sampleQR = "00020101021126580016A0000006770101110113006600000000010208MyPay005802MY5910MyCafe JB6011JohorBahru61051058062540417MYR0108DuitNow0208A0000006";
handleScannedQR(sampleQR);