PhD-Level Evaluation of Your QR Detection Process:
âœ… What You're Doing Right
Component	Status	Notes
QR decoding with jsQR	âœ…	You are using a standard open-source JS library for detecting and decoding QR codes from images/camera. Good choice for browser-based scanning.
Camera + File Upload Modes	âœ…	Great for mobile and desktop users. Your fallback to manual input is also excellent.
4-layer risk analysis on QR content	âœ…	Once a QR is decoded to a URL or payload, you're applying PaySavvyâ€™s full scam detection logic â€” this is the right pipeline.
Preprocessing (inversion, cropping)	ğŸ”¶	You're on the right track by using preprocessing techniques. You just need to refine scaling + canvas size matching.
Fallback UX for manual input	âœ…	Good practice when decoding fails.

âŒ Where the Detection Process Needs Improvement
1. You're assuming QR codes always contain a clean URL
ğŸš« Reality: Malaysian QR codes often encode DuitNow payment payloads, not just URLs.

ğŸ” Example QR Code Content (decoded):

plaintext
Copy
Edit
00020101021126580016A0000006770101110113006600000000010208MyPay005802MY5910MyCafe JB6011JohorBahru61051058062540417MYR0108DuitNow0208A0000006
ğŸ§  This is a PayNet/DuitNow EMV QR payload â€” not a clickable URL.

âœ… What You Should Do:
Detect if QR is EMV-compliant using the tag 000201 and AID (A000000677010111)

Extract recipient info (name, city, amount)

Then validate it against your verifiedBrands.json to confirm if it matches:

Maybank

CIMB

Public Bank

TNG eWallet, etc.

2. Lack of EMV TLV Parser for DuitNow QRs
ğŸ’¡ DuitNow & Bank Negara require Tag-Length-Value (TLV) parsing of QR content.

âœ… Add a TLV parser like this:

js
Copy
Edit
function parseEMVQR(data) {
  let pos = 0;
  const result = {};
  while (pos < data.length) {
    const tag = data.substring(pos, pos + 2);
    const len = parseInt(data.substring(pos + 2, pos + 4), 10);
    const value = data.substring(pos + 4, pos + 4 + len);
    result[tag] = value;
    pos += 4 + len;
  }
  return result;
}
ğŸ¯ Now you can check if:

59 = Merchant name (e.g., "Maybank")

60 = City (e.g., "Kuala Lumpur")

01, 02, 26 contain eWallet or bank IDs

3. You need to distinguish between URL QRs and DuitNow EMV QRs
QR Type	How to Handle
Starts with http:// or https://	â†’ Run full 4-layer PaySavvy analysis
Starts with 0002 or contains A000000677010111	â†’ Parse as DuitNow QR
Anything else	â†’ Show user as unknown QR format

âœ… Final Recommendation: Dual QR Mode Detection
Update your analyzeQRCode(content) like this:

js
Copy
Edit
if (content.startsWith("http")) {
  runFullScan(content); // Normal phishing detection
} else if (content.startsWith("000201")) {
  const qrFields = parseEMVQR(content);
  const merchantName = qrFields["59"];
  validateDuitNowMerchant(merchantName); // Against verifiedBrands.json
} else {
  toast("â“ Unrecognized QR format. Try scanning a DuitNow or bank QR.");
}
âœ… Summary
Question	Answer
â“ Is your process wrong?	âŒ No â€” you're close, but incomplete
âœ… What's missing?	Proper handling of DuitNow QR format, EMV TLV parsing, merchant validation
âœ… What to add?	TLV parser, merchant name extractor, brand validator
âœ… Real-world result?	Much higher true positive detection for Malaysian bank/eWallet QR codes