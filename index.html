<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaySavvy Pro - AI Scam Link Detector</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        :root {
            --primary-color: #059669;
            --primary-light: #10b981;
            --primary-dark: #047857;
            --secondary-color: #6b7280;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #064e3b;
            --card-bg: #ffffff;
            --text-primary: #064e3b;
            --text-secondary: #374151;
            --border-color: #d1fae5;
            --accent-green: #dcfce7;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #bbf7d0 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .main-container {
            min-height: 100vh;
            padding: 1rem;
        }

        .app-header {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 0;
        }

        .scan-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .form-control {
            border-radius: 12px;
            border: 2px solid var(--border-color);
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(5, 150, 105, 0.25);
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .alert {
            border-radius: 12px;
            border: none;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border-left: 4px solid var(--warning-color);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        .badge {
            font-size: 0.8rem;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
        }

        .badge-success {
            background: var(--success-color);
        }

        .badge-warning {
            background: var(--warning-color);
        }

        .badge-danger {
            background: var(--danger-color);
        }

        .results-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .toast {
            margin-bottom: 10px;
            border-radius: 12px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .toast.success {
            background: var(--success-color);
            color: white;
        }

        .toast.error {
            background: var(--danger-color);
            color: white;
        }

        .toast.warning {
            background: var(--warning-color);
            color: white;
        }

        .toast.info {
            background: var(--primary-color);
            color: white;
        }

        .toast-header {
            background: transparent;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            color: inherit;
        }

        .btn-close-white {
            filter: brightness(0) invert(1);
        }

        .d-none {
            display: none !important;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .feature-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0.5rem;
            }
            
            .app-header, .scan-card, .results-card {
                padding: 1.5rem;
                margin-bottom: 1rem;
            }
            
            .logo {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay d-none">
        <div class="loading-content">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5>Analyzing URL...</h5>
            <p class="text-muted mb-0">AI-powered scam detection in progress</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <div class="main-container">
        <div class="container">
            <!-- Header -->
            <div class="app-header text-center">
                <div class="logo">PaySavvy Pro</div>
                <p class="tagline">AI-Powered Scam Link Detection for Malaysia</p>
            </div>

            <!-- Main Scan Form -->
            <div class="scan-card">
                <h3 class="mb-4">
                    <i data-feather="shield" class="me-2"></i>
                    Scan Suspicious Links
                </h3>
                
                <form id="scanForm">
                    <div class="mb-3">
                        <label for="urlInput" class="form-label">Enter URL to scan:</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="urlInput" 
                            placeholder="https://example.com/suspicious-link"
                            required
                        >
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg w-100" id="scanButton">
                        <i data-feather="shield" class="me-2"></i>
                        Scan Link Now
                    </button>
                </form>

                <!-- Error Message -->
                <div id="errorMessage" class="alert alert-danger d-none mt-3" role="alert">
                    <i data-feather="alert-triangle" class="me-2"></i>
                    <span id="errorText"></span>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results" class="results-card d-none">
                <h4 class="mb-3">
                    <i data-feather="search" class="me-2"></i>
                    Scan Results
                </h4>
                <div id="resultsContent"></div>
            </div>

            <!-- Features Section -->
            <div class="feature-grid">
                <div class="feature-card">
                    <i data-feather="shield" class="feature-icon"></i>
                    <h5>AI Detection</h5>
                    <p class="text-muted">Advanced AI analysis using OpenAI GPT-4o</p>
                </div>
                <div class="feature-card">
                    <i data-feather="globe" class="feature-icon"></i>
                    <h5>Malaysian Focus</h5>
                    <p class="text-muted">Specialized for local banking and e-wallet scams</p>
                </div>
                <div class="feature-card">
                    <i data-feather="zap" class="feature-icon"></i>
                    <h5>Real-time Analysis</h5>
                    <p class="text-muted">Instant pattern matching and threat detection</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom Application Script -->
    <script>
        // PaySavvy Pro - Production-Ready Application
        class PaySavvyApp {
            constructor() {
                this.apiKey = this.getApiKey();
                this.baseUrl = 'https://api.openai.com/v1/chat/completions';
                this.toastContainer = null;
                this.loadingOverlay = null;
                this.errorHandlers = new Map();
                this.init();
            }

            // Get API Key from environment
            getApiKey() {
                // Check multiple sources for API key
                if (window.ENV && window.ENV.VITE_OPENAI_API_KEY) {
                    return window.ENV.VITE_OPENAI_API_KEY;
                }
                if (window.VITE_OPENAI_API_KEY) {
                    return window.VITE_OPENAI_API_KEY;
                }
                if (window.OPENAI_API_KEY) {
                    return window.OPENAI_API_KEY;
                }
                return '';
            }

            init() {
                console.log('PaySavvy Pro Production Version initializing...');
                this.toastContainer = document.getElementById('toastContainer');
                this.loadingOverlay = document.getElementById('loadingOverlay');
                this.setupErrorHandlers();
                this.setupEventListeners();
                
                // Initialize Feather icons
                feather.replace();
                
                this.showToast('PaySavvy Pro Ready', 'Production version loaded successfully', 'success', 3000);
                console.log('PaySavvy Production ready! API Key:', this.apiKey ? 'Configured' : 'Missing');
            }

            setupErrorHandlers() {
                // Custom error classes
                window.ValidationError = class extends Error {
                    constructor(message) {
                        super(message);
                        this.name = 'ValidationError';
                    }
                };

                window.APIError = class extends Error {
                    constructor(message, status) {
                        super(message);
                        this.name = 'APIError';
                        this.status = status;
                    }
                };

                window.NetworkError = class extends Error {
                    constructor(message) {
                        super(message);
                        this.name = 'NetworkError';
                    }
                };

                // Error handlers
                this.errorHandlers.set('validation', (error, context) => {
                    this.showToast('Validation Error', error.message, 'warning');
                });

                this.errorHandlers.set('api', (error, context) => {
                    this.showToast('API Error', error.message, 'error');
                });

                this.errorHandlers.set('network', (error, context) => {
                    this.showToast('Network Error', 'Please check your internet connection', 'error');
                });

                // Global error handler
                window.addEventListener('error', (event) => {
                    console.error('Global error:', event.error);
                    this.showToast('Application Error', 'An unexpected error occurred', 'error');
                });
            }

            setupEventListeners() {
                const form = document.getElementById('scanForm');
                const urlInput = document.getElementById('urlInput');

                form.addEventListener('submit', (e) => this.handleScan(e));
                
                // Real-time URL validation
                urlInput.addEventListener('input', (e) => {
                    this.validateUrlInput(e.target.value);
                });
            }

            validateUrlInput(url) {
                const urlInput = document.getElementById('urlInput');
                
                if (url && !this.isValidUrl(url)) {
                    urlInput.classList.add('is-invalid');
                    return false;
                } else {
                    urlInput.classList.remove('is-invalid');
                    return true;
                }
            }

            isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            async handleScan(event) {
                event.preventDefault();
                
                const urlInput = document.getElementById('urlInput');
                const url = urlInput.value.trim();

                // Validation
                if (!url) {
                    throw new ValidationError('Please enter a URL to scan');
                }

                if (!this.isValidUrl(url)) {
                    throw new ValidationError('Please enter a valid URL (e.g., https://example.com)');
                }

                if (!this.apiKey) {
                    this.showToast('API Key Required', 'OpenAI API key is not configured. Please check your environment settings.', 'warning', 8000);
                    return;
                }

                try {
                    this.showFullScreenLoading(true);
                    this.showLoading(true);
                    this.hideError();

                    console.log('Scanning URL:', url);

                    // Perform comprehensive analysis
                    const results = await this.performComprehensiveAnalysis(url);
                    
                    this.displayResults(results);
                    this.showToast('Scan Complete', 'URL analysis completed successfully', 'success');

                } catch (error) {
                    console.error('Scan error:', error);
                    this.handleError(error, this.getErrorType(error));
                } finally {
                    this.showFullScreenLoading(false);
                    this.showLoading(false);
                }
            }

            async performComprehensiveAnalysis(url) {
                // Pattern-based analysis
                const patternAnalysis = this.analyzePatterns(url);
                
                // AI-powered analysis
                const aiAnalysis = await this.analyzeWithAI(url);
                
                // Combine results
                const finalResult = this.combineAnalysis(patternAnalysis, aiAnalysis);
                
                return {
                    url,
                    timestamp: new Date().toISOString(),
                    patternAnalysis,
                    aiAnalysis,
                    finalResult
                };
            }

            analyzePatterns(url) {
                let score = 0;
                const flags = [];

                // Malaysian bank typosquatting check
                const suspiciousBankPatterns = [
                    'mayb4nk', 'mayb@nk', 'maybankk', 'may-bank',
                    'publicb@nk', 'publicbankk', 'public-bank',
                    'rhbb@nk', 'rhbbankk', 'rhb-bank',
                    'cimbankk', 'cimb@nk', 'cimb-bank'
                ];

                for (const pattern of suspiciousBankPatterns) {
                    if (url.toLowerCase().includes(pattern)) {
                        score += 3;
                        flags.push(`Suspicious banking domain pattern: ${pattern}`);
                    }
                }

                // Suspicious TLD check
                const suspiciousTlds = ['.tk', '.ml', '.ga', '.cf', '.ru', '.biz', '.cc'];
                for (const tld of suspiciousTlds) {
                    if (url.toLowerCase().includes(tld)) {
                        score += 2;
                        flags.push(`Suspicious TLD: ${tld}`);
                    }
                }

                // URL shortener check
                const shorteners = ['bit.ly', 'tinyurl', 'short.link', 'ow.ly'];
                for (const shortener of shorteners) {
                    if (url.toLowerCase().includes(shortener)) {
                        score += 1;
                        flags.push(`URL shortener detected: ${shortener}`);
                    }
                }

                // Determine risk level
                let riskLevel = 'safe';
                if (score >= 5) riskLevel = 'dangerous';
                else if (score >= 3) riskLevel = 'suspicious';

                return {
                    score,
                    flags,
                    riskLevel,
                    explanation: this.generateExplanation(riskLevel, flags)
                };
            }

            async analyzeWithAI(url) {
                if (!this.apiKey) {
                    throw new APIError('OpenAI API key not configured');
                }

                const prompt = `You are a cybersecurity expert specializing in Malaysian digital payment scams. Analyze this URL for potential scam characteristics:

URL: ${url}

Focus on:
1. Domain legitimacy for Malaysian banks/e-wallets (Maybank, CIMB, Public Bank, RHB, Grab, Boost, Touch'n Go, etc.)
2. Typosquatting patterns
3. Suspicious TLDs or hosting
4. Social engineering tactics
5. URL structure anomalies

Respond with JSON only:
{
  "riskLevel": "safe|suspicious|dangerous",
  "confidence": 0.0-1.0,
  "explanation": "Clear explanation for Malaysian users",
  "flags": ["specific concerns found"],
  "suggestions": ["actionable safety advice"]
}`;

                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a cybersecurity expert specializing in scam detection. Always respond with valid JSON.'
                                },
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            temperature: 0.3,
                            max_tokens: 1000
                        })
                    });

                    if (!response.ok) {
                        throw new APIError(`API request failed: ${response.status} ${response.statusText}`, response.status);
                    }

                    const data = await response.json();
                    
                    if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                        throw new APIError('Invalid API response format');
                    }

                    const content = data.choices[0].message.content.trim();
                    
                    try {
                        return JSON.parse(content);
                    } catch (parseError) {
                        console.error('AI response parsing error:', parseError);
                        throw new APIError('Failed to parse AI response');
                    }

                } catch (error) {
                    console.error('AI analysis error:', error);
                    if (error.name === 'APIError') {
                        throw error;
                    }
                    throw new NetworkError('Failed to connect to AI service');
                }
            }

            combineAnalysis(patternAnalysis, aiAnalysis) {
                const patternScore = patternAnalysis.score;
                const aiConfidence = aiAnalysis?.confidence || 0;
                
                // Combine risk levels
                const riskLevels = ['safe', 'suspicious', 'dangerous'];
                const patternRiskIndex = riskLevels.indexOf(patternAnalysis.riskLevel);
                const aiRiskIndex = aiAnalysis ? riskLevels.indexOf(aiAnalysis.riskLevel) : 0;
                
                const finalRiskIndex = Math.max(patternRiskIndex, aiRiskIndex);
                const finalRiskLevel = riskLevels[finalRiskIndex];

                // Combine flags and suggestions
                const allFlags = [...patternAnalysis.flags];
                const allSuggestions = ['Always verify links before clicking', 'Check for official bank websites'];
                
                if (aiAnalysis) {
                    allFlags.push(...(aiAnalysis.flags || []));
                    allSuggestions.push(...(aiAnalysis.suggestions || []));
                }

                return {
                    riskLevel: finalRiskLevel,
                    confidence: Math.max(aiConfidence, patternScore / 10),
                    explanation: this.generateFinalExplanation(finalRiskLevel, allFlags),
                    flags: allFlags,
                    suggestions: allSuggestions,
                    combinedScore: patternScore + (aiConfidence * 10)
                };
            }

            generateExplanation(riskLevel, flags) {
                switch(riskLevel) {
                    case 'safe':
                        return 'This URL appears to be safe based on pattern analysis.';
                    case 'suspicious':
                        return `This URL shows some suspicious characteristics: ${flags.slice(0, 2).join(', ')}`;
                    case 'dangerous':
                        return `This URL is potentially dangerous: ${flags.slice(0, 3).join(', ')}`;
                    default:
                        return 'Analysis completed.';
                }
            }

            generateFinalExplanation(riskLevel, flags) {
                const flagCount = flags.length;
                switch(riskLevel) {
                    case 'safe':
                        return `This URL appears to be safe. ${flagCount > 0 ? `Minor concerns detected: ${flagCount} flags` : 'No major threats detected.'}`;
                    case 'suspicious':
                        return `This URL shows suspicious characteristics (${flagCount} flags detected). Exercise caution before proceeding.`;
                    case 'dangerous':
                        return `This URL is potentially dangerous (${flagCount} flags detected). Avoid clicking and report if received via message.`;
                    default:
                        return 'Analysis completed with mixed results.';
                }
            }

            displayResults(results) {
                const resultsDiv = document.getElementById('results');
                const resultsContent = document.getElementById('resultsContent');
                
                const { finalResult, patternAnalysis, aiAnalysis } = results;
                
                const alertClass = this.getAlertClass(finalResult.riskLevel);
                const badgeClass = this.getBadgeClass(finalResult.riskLevel);
                const iconName = this.getIconName(finalResult.riskLevel);

                resultsContent.innerHTML = `
                    <div class="alert ${alertClass}">
                        <div class="d-flex align-items-center mb-2">
                            <i data-feather="${iconName}" class="me-2"></i>
                            <strong>Risk Level: </strong>
                            <span class="badge ${badgeClass} ms-2">${finalResult.riskLevel.toUpperCase()}</span>
                        </div>
                        <p class="mb-0">${finalResult.explanation}</p>
                    </div>

                    ${finalResult.flags.length > 0 ? `
                        <div class="mb-3">
                            <h6><i data-feather="alert-triangle" class="me-2"></i>Detected Issues:</h6>
                            <ul class="mb-0">
                                ${finalResult.flags.map(flag => `<li>${flag}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    ${finalResult.suggestions.length > 0 ? `
                        <div class="mb-3">
                            <h6><i data-feather="shield" class="me-2"></i>Safety Recommendations:</h6>
                            <ul class="mb-0">
                                ${finalResult.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <strong>Pattern Analysis:</strong> ${patternAnalysis.score} risk points
                            </small>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted">
                                <strong>AI Confidence:</strong> ${aiAnalysis ? (aiAnalysis.confidence * 100).toFixed(1) : 'N/A'}%
                            </small>
                        </div>
                    </div>
                `;

                // Replace feather icons and show results
                feather.replace();
                resultsDiv.classList.remove('d-none');
                
                // Scroll to results
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            }

            getAlertClass(riskLevel) {
                switch(riskLevel) {
                    case 'safe': return 'alert-success';
                    case 'suspicious': return 'alert-warning';
                    case 'dangerous': return 'alert-danger';
                    default: return 'alert-info';
                }
            }

            getBadgeClass(riskLevel) {
                switch(riskLevel) {
                    case 'safe': return 'badge-success';
                    case 'suspicious': return 'badge-warning';
                    case 'dangerous': return 'badge-danger';
                    default: return 'bg-secondary';
                }
            }

            getIconName(riskLevel) {
                switch(riskLevel) {
                    case 'safe': return 'check-circle';
                    case 'suspicious': return 'alert-triangle';
                    case 'dangerous': return 'x-circle';
                    default: return 'info';
                }
            }

            getErrorType(error) {
                if (error.name === 'ValidationError') return 'validation';
                if (error.name === 'APIError') return 'api';
                if (error.name === 'NetworkError') return 'network';
                return 'general';
            }

            showError(message) {
                const errorElement = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');
                errorText.textContent = message;
                errorElement.classList.remove('d-none');
                feather.replace();
            }

            hideError() {
                const errorElement = document.getElementById('errorMessage');
                errorElement.classList.add('d-none');
            }

            // Toast Notification System
            showToast(title, message, type = 'info', duration = 5000) {
                if (!this.toastContainer) return;

                const toastId = 'toast-' + Date.now();
                const toastElement = document.createElement('div');
                toastElement.className = `toast ${type}`;
                toastElement.id = toastId;
                toastElement.setAttribute('role', 'alert');
                toastElement.setAttribute('aria-live', 'assertive');
                toastElement.setAttribute('aria-atomic', 'true');

                const iconMap = {
                    success: 'check-circle',
                    error: 'x-circle',
                    warning: 'alert-triangle',
                    info: 'info'
                };

                toastElement.innerHTML = `
                    <div class="toast-header">
                        <i data-feather="${iconMap[type]}" class="me-2"></i>
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                `;

                this.toastContainer.appendChild(toastElement);
                
                // Initialize Bootstrap toast
                const bsToast = new bootstrap.Toast(toastElement, {
                    autohide: duration > 0,
                    delay: duration
                });

                // Replace feather icons
                feather.replace();

                // Show toast
                bsToast.show();

                // Auto-remove after hiding
                toastElement.addEventListener('hidden.bs.toast', () => {
                    toastElement.remove();
                });

                return toastId;
            }

            // Error Handling System
            handleError(error, type = 'general', context = '') {
                console.error(`Error [${type}]:`, error);
                
                const handler = this.errorHandlers.get(type);
                if (handler) {
                    handler(error, context);
                } else {
                    // Default error handling
                    this.showToast('Error', error.message || 'An unexpected error occurred', 'error');
                }
            }

            // Loading States
            showFullScreenLoading(show) {
                if (!this.loadingOverlay) return;
                
                if (show) {
                    this.loadingOverlay.classList.remove('d-none');
                } else {
                    this.loadingOverlay.classList.add('d-none');
                }
            }

            showLoading(show) {
                const button = document.getElementById('scanButton');
                const results = document.getElementById('results');
                
                if (show) {
                    button.disabled = true;
                    button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Analyzing...';
                    results.classList.add('d-none');
                } else {
                    button.disabled = false;
                    button.innerHTML = '<i data-feather="shield" class="me-2"></i>Scan Link Now';
                    feather.replace();
                }
            }
        }

        // Initialize application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.payсавvy = new PaySavvyApp();
        });
    </script>
</body>
</html>